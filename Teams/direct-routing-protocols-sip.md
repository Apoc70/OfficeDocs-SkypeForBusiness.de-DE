---
title: Direktes Routing für Telefonsysteme
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.date: 01/28/2019
ms.topic: article
ms.service: msteams
audience: admin
ms.collection:
- Teams_ITAdmin_Help
- M365-voice
ms.reviewer: nmurav
search.appverid: MET150
f1.keywords:
- NOCSH
description: Direkte Routing Protokolle
appliesto:
- Microsoft Teams
ms.openlocfilehash: 6b93ea469a1a27e796b5cc2016fd63c9cfd3acdd
ms.sourcegitcommit: 1a08ec9069332e19135312d35fc6a6c3247ce2d2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/11/2020
ms.locfileid: "41888564"
---
# <a name="direct-routing---sip-protocol"></a><span data-ttu-id="8511b-103">Direct Routing – SIP-Protokoll</span><span class="sxs-lookup"><span data-stu-id="8511b-103">Direct Routing - SIP protocol</span></span>

<span data-ttu-id="8511b-104">In diesem Artikel wird beschrieben, wie das direkte Routing das Session Initiation Protocol (SIP) implementiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-104">This article describes how Direct Routing implements the Session Initiation Protocol (SIP).</span></span> <span data-ttu-id="8511b-105">Um den Datenverkehr zwischen einem Session Border Controller (SBC) und dem SIP-Proxy ordnungsgemäß weiterzuleiten, müssen einige SIP-Parameter bestimmte Werte aufweisen.</span><span class="sxs-lookup"><span data-stu-id="8511b-105">To properly route traffic between a Session Border Controller (SBC) and the SIP proxy, some SIP parameters must have specific values.</span></span> <span data-ttu-id="8511b-106">Dieser Artikel richtet sich an sprach Administratoren, die für die Konfiguration der Verbindung zwischen dem lokalen SBC und dem SIP-Proxydienst verantwortlich sind.</span><span class="sxs-lookup"><span data-stu-id="8511b-106">This article is intended for voice administrators who are responsible for configuring the connection between the on-premises SBC and the SIP proxy service.</span></span>

## <a name="processing-the-incoming-request-finding-the-tenant-and-user"></a><span data-ttu-id="8511b-107">Verarbeiten der eingehenden Anforderung: Suchen des Mandanten und des Benutzers</span><span class="sxs-lookup"><span data-stu-id="8511b-107">Processing the incoming request: finding the tenant and user</span></span>

<span data-ttu-id="8511b-108">Bei einem eingehenden Anruf muss der SIP-Proxy den Mandanten finden, zu dem der Anruf bestimmt ist, und den jeweiligen Nutzer innerhalb dieses Mandanten finden.</span><span class="sxs-lookup"><span data-stu-id="8511b-108">On an incoming call, the SIP proxy needs to find the tenant to which the call is destined and find the specific user within this tenant.</span></span> <span data-ttu-id="8511b-109">Der mandantenadministrator kann nicht-DID-Nummern konfigurieren, beispielsweise + 1001, in mehreren Mandanten.</span><span class="sxs-lookup"><span data-stu-id="8511b-109">The tenant administrator might configure non-DID numbers, for example +1001, in multiple tenants.</span></span> <span data-ttu-id="8511b-110">Daher ist es wichtig, den jeweiligen Mandanten zu finden, für den die Nummernsuche durchgeführt werden soll, da die nicht-DID-Nummern in mehreren Office 365-Mandanten identisch sein können.</span><span class="sxs-lookup"><span data-stu-id="8511b-110">Therefore, it is important to find the specific tenant on which to perform the number lookup because the non-DID numbers might be the same in multiple Office 365 tenants.</span></span>  

<span data-ttu-id="8511b-111">In diesem Abschnitt wird beschrieben, wie der SIP-Proxy den Mandanten und den Benutzer findet und die Authentifizierung des SBC für die eingehende Verbindung ausführt.</span><span class="sxs-lookup"><span data-stu-id="8511b-111">This section describes how the SIP proxy finds the tenant and the user, and performs authentication of the SBC on the incoming connection.</span></span>

<span data-ttu-id="8511b-112">Der folgende Code ist ein Beispiel für die SIP-Einladungsnachricht bei einem eingehenden Anruf:</span><span class="sxs-lookup"><span data-stu-id="8511b-112">The following is an example of the SIP Invite message on an incoming call:</span></span>

| <span data-ttu-id="8511b-113">Parameter Name</span><span class="sxs-lookup"><span data-stu-id="8511b-113">Parameter name</span></span> | <span data-ttu-id="8511b-114">Beispiel für den Wert</span><span class="sxs-lookup"><span data-stu-id="8511b-114">Example of the value</span></span> | 
| :---------------------  |:---------------------- |
| <span data-ttu-id="8511b-115">Request-URI</span><span class="sxs-lookup"><span data-stu-id="8511b-115">Request-URI</span></span> | <span data-ttu-id="8511b-116">INVITE SIP:+18338006777@SIP.pstnhub.Microsoft.com SIP/2,0</span><span class="sxs-lookup"><span data-stu-id="8511b-116">INVITE sip:+18338006777@sip.pstnhub.microsoft.com SIP /2.0</span></span> |
| <span data-ttu-id="8511b-117">Überschrift</span><span class="sxs-lookup"><span data-stu-id="8511b-117">Via Header</span></span> | <span data-ttu-id="8511b-118">Über: SIP/2.0/TLS sbc1. adatum. biz: 5058; Alias; Branch = z9hG4bKac2121518978</span><span class="sxs-lookup"><span data-stu-id="8511b-118">Via: SIP/2.0/TLS sbc1.adatum.biz:5058;alias;branch=z9hG4bKac2121518978</span></span> | 
| <span data-ttu-id="8511b-119">Max-Forwards-Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-119">Max-Forwards header</span></span> | <span data-ttu-id="8511b-120">Max-Forwards: 68</span><span class="sxs-lookup"><span data-stu-id="8511b-120">Max-Forwards:68</span></span> |
| <span data-ttu-id="8511b-121">From-Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-121">From Header</span></span> | <span data-ttu-id="8511b-122">From Header from: <SIP: 7168712781@sbc1. adatum. biz; Transport = UDP; Tag = 1c747237679</span><span class="sxs-lookup"><span data-stu-id="8511b-122">From Header From: <sip:7168712781@sbc1.adatum.biz;transport=udp;tag=1c747237679</span></span> |
| <span data-ttu-id="8511b-123">Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-123">To Header</span></span> | <span data-ttu-id="8511b-124">An: SIP:+183338006777@sbc1.adatum.biz</span><span class="sxs-lookup"><span data-stu-id="8511b-124">To: sip:+183338006777@sbc1.adatum.biz</span></span> | 
| <span data-ttu-id="8511b-125">CSeq-Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-125">CSeq header</span></span> | <span data-ttu-id="8511b-126">CSeq: 1 Einladung</span><span class="sxs-lookup"><span data-stu-id="8511b-126">CSeq: 1 INVITE</span></span> | 
| <span data-ttu-id="8511b-127">Kontakt Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-127">Contact Header</span></span> | <span data-ttu-id="8511b-128">Kontakt: <SIP: 68712781@sbc1. adatum. biz; Transport = TLS></span><span class="sxs-lookup"><span data-stu-id="8511b-128">Contact: <sip: 68712781@sbc1.adatum.biz;transport=tls></span></span> | 

<span data-ttu-id="8511b-129">Beim Empfang der Einladung führt der SIP-Proxy die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="8511b-129">On receiving the invite, the SIP proxy performs the following steps:</span></span>

1. <span data-ttu-id="8511b-130">Überprüfen Sie das Zertifikat.</span><span class="sxs-lookup"><span data-stu-id="8511b-130">Check the certificate.</span></span> <span data-ttu-id="8511b-131">Bei der ersten Verbindung übernimmt der Direct Routing-Dienst den FQDN-Namen, der in der Kontakt Kopfzeile angezeigt wird, und vergleicht ihn mit dem allgemeinen Namen oder dem alternativen Subjektnamen des vorgestellten Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="8511b-131">On the initial connection, the Direct Routing service takes the FQDN name presented in the Contact header and matches it to the Common Name or Subject Alternative name of the presented certificate.</span></span> <span data-ttu-id="8511b-132">Der SBC-Name muss mit einer der folgenden Optionen übereinstimmen:</span><span class="sxs-lookup"><span data-stu-id="8511b-132">The SBC name must match one of the following options:</span></span>

   - <span data-ttu-id="8511b-133">Option 1.</span><span class="sxs-lookup"><span data-stu-id="8511b-133">Option 1.</span></span> <span data-ttu-id="8511b-134">Der vollständige FQDN-Name, der in der Kontakt Kopfzeile angezeigt wird, muss dem allgemeinen Namen/Subjekt alternativen Namen des vorgestellten Zertifikats entsprechen.</span><span class="sxs-lookup"><span data-stu-id="8511b-134">The full FQDN name presented in the Contact header must match the Common Name/Subject Alternative name of the presented certificate.</span></span>  

   - <span data-ttu-id="8511b-135">Option 2.</span><span class="sxs-lookup"><span data-stu-id="8511b-135">Option 2.</span></span> <span data-ttu-id="8511b-136">Der Domänenteil des FQDN-namens, der in der Kontakt Kopfzeile angezeigt wird (beispielsweise adatum.biz des FQDN-namens sbc1.adatum.biz), muss dem Platzhalterwert im allgemeinen Namen/Subjekt alternativen Namen (beispielsweise \*. adatum.biz) entsprechen.</span><span class="sxs-lookup"><span data-stu-id="8511b-136">The domain portion of the FQDN name presented in the Contact header (for example adatum.biz of the FQDN name sbc1.adatum.biz) must match the wildcard value in Common Name/Subject Alternative Name (for example \*.adatum.biz).</span></span>

2. <span data-ttu-id="8511b-137">Versuchen Sie, einen Mandanten mit dem vollständigen FQDN-Namen zu finden, der in der Kontakt Kopfzeile dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="8511b-137">Try to find a tenant using the full FQDN name presented in the Contact header.</span></span>  

   <span data-ttu-id="8511b-138">Überprüfen Sie, ob der FQDN-Name aus der Kontakt Kopfzeile (sbc1.adatum.biz) in einem Office 365-Mandanten als DNS-Name registriert ist.</span><span class="sxs-lookup"><span data-stu-id="8511b-138">Check if the FQDN name from the Contact header (sbc1.adatum.biz) is registered as a DNS name in any Office 365 tenant.</span></span> <span data-ttu-id="8511b-139">Wenn Sie gefunden wird, wird die Suche des Benutzers im Mandanten durchgeführt, auf dem der SBC-FQDN als Domänenname registriert ist.</span><span class="sxs-lookup"><span data-stu-id="8511b-139">If found, the lookup of the user is performed in the tenant that has the SBC FQDN registered as a Domain name.</span></span> <span data-ttu-id="8511b-140">Wenn Sie nicht gefunden wird, gilt Schritt 3.</span><span class="sxs-lookup"><span data-stu-id="8511b-140">If not found, Step 3 applies.</span></span>   

3. <span data-ttu-id="8511b-141">Schritt 3 gilt nur, wenn Schritt 2 fehlgeschlagen ist.</span><span class="sxs-lookup"><span data-stu-id="8511b-141">Step 3 only applies if Step 2 failed.</span></span> 

   <span data-ttu-id="8511b-142">Entfernen Sie den Host Anteil aus dem FQDN, der in der Kontakt Kopfzeile (FQDN: sbc12.adatum.biz nach dem Entfernen des Host Abschnitts: adatum.biz) angezeigt wird, und überprüfen Sie, ob dieser Name in einem beliebigen Office 365-Mandanten als DNS-Name registriert ist.</span><span class="sxs-lookup"><span data-stu-id="8511b-142">Remove the host portion from the FQDN, presented in the Contact header (FQDN: sbc12.adatum.biz, after removing the host portion: adatum.biz), and check if this name is registered as a DNS name in any Office 365 tenant.</span></span> <span data-ttu-id="8511b-143">Wenn Sie gefunden wird, wird die Benutzersuche in diesem Mandanten ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="8511b-143">If found, the user lookup is performed in this tenant.</span></span> <span data-ttu-id="8511b-144">Wenn nicht gefunden, schlägt der Anruf fehl.</span><span class="sxs-lookup"><span data-stu-id="8511b-144">If not found, the call fails.</span></span>

4. <span data-ttu-id="8511b-145">Führen Sie mit der im Anforderungs-URI vorgestellten Telefonnummer die umgekehrte Nummernsuche innerhalb des Mandanten durch, der in Schritt 2 oder 3 gefunden wurde.</span><span class="sxs-lookup"><span data-stu-id="8511b-145">Using the phone number presented in the Request-URI, perform the reverse number lookup within the tenant found in Step 2 or 3.</span></span> <span data-ttu-id="8511b-146">Vergleichen Sie die vorgestellten Telefonnummern mit einem SIP-URI des Benutzers innerhalb des Mandanten, der im vorherigen Schritt gefunden wurde.</span><span class="sxs-lookup"><span data-stu-id="8511b-146">Match the presented phone number to a user SIP URI within the tenant found on the previous step.</span></span>

5. <span data-ttu-id="8511b-147">Übernehmen Sie trunk-Einstellungen.</span><span class="sxs-lookup"><span data-stu-id="8511b-147">Apply trunk settings.</span></span> <span data-ttu-id="8511b-148">Suchen Sie die vom mandantenadministrator für diesen SBC festgelegten Parameter.</span><span class="sxs-lookup"><span data-stu-id="8511b-148">Find the parameters set by the tenant admin for this SBC.</span></span>

   <span data-ttu-id="8511b-149">Microsoft unterstützt nicht die Nutzung eines SIP-Proxys eines Drittanbieters oder eines Benutzer-Agent-Servers zwischen dem Microsoft SIP-Proxy und dem gekoppelten SBC, wodurch der vom gekoppelten SBC erstellte Anforderungs-URI geändert werden kann.</span><span class="sxs-lookup"><span data-stu-id="8511b-149">Microsoft does not support having a third-party SIP proxy or User Agent Server between the Microsoft SIP proxy and the paired SBC, which might modify the Request URI created by the paired SBC.</span></span>

   <span data-ttu-id="8511b-150">Die Anforderungen für die beiden Nachschlagevorgänge (Schritte 2 und 3), die für das Szenario erforderlich sind, in dem ein SBC mit vielen Mandanten (Carrier-Szenario) verbunden ist, werden später in diesem Artikel behandelt.</span><span class="sxs-lookup"><span data-stu-id="8511b-150">The requirements for the two lookups (steps 2 and 3) needed for the scenario where one SBC is interconnected to many tenants (carrier scenario) are covered later in this article.</span></span>

### <a name="detailed-requirements-for-contact-header-and-request-uri"></a><span data-ttu-id="8511b-151">Detaillierte Anforderungen für Kontakt Kopf-und Anforderungs-URI</span><span class="sxs-lookup"><span data-stu-id="8511b-151">Detailed requirements for Contact header and Request-URI</span></span>

#### <a name="contact-header"></a><span data-ttu-id="8511b-152">Kontakt Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-152">Contact header</span></span>

<span data-ttu-id="8511b-153">Für alle eingehenden Anrufe an den Microsoft SIP-Proxy muss der Kontakt Kopf den gepaarten SBC-FQDN im URI-Hostname wie folgt aufweisen:</span><span class="sxs-lookup"><span data-stu-id="8511b-153">For all incoming calls to the Microsoft SIP proxy, the Contact header must have the paired SBC FQDN in the URI hostname as follows:</span></span>

<span data-ttu-id="8511b-154">Syntax: Contact: <SIP: Telefon-oder SIP-Address@FQDN des SBC; Transport = TLS></span><span class="sxs-lookup"><span data-stu-id="8511b-154">Syntax: Contact:  <sip:phone or sip address@FQDN of the SBC;transport=tls></span></span> 

<span data-ttu-id="8511b-155">Dieser Name muss sich auch im Feld "allgemeiner Name" oder "alternativer Antragstellername" (n) des vorgestellten Zertifikats befinden.</span><span class="sxs-lookup"><span data-stu-id="8511b-155">This name must also be in the Common Name or Subject Alternative name field(s) of the presented certificate.</span></span> <span data-ttu-id="8511b-156">Microsoft unterstützt die Verwendung von Platzhalterwerten der Namen in den Feldern allgemeiner Name oder alternativer Antragstellername des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="8511b-156">Microsoft supports using wildcard values of the name(s) in the Common Name or Subject Alternative Name fields of the certificate.</span></span>   

<span data-ttu-id="8511b-157">Die Unterstützung für Platzhalter wird in [RFC 2818, Abschnitt 3,1,](https://tools.ietf.org/html/rfc2818#section-3.1)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8511b-157">The support for wildcards is described in [RFC 2818, section 3.1](https://tools.ietf.org/html/rfc2818#section-3.1).</span></span> <span data-ttu-id="8511b-158">Speziell</span><span class="sxs-lookup"><span data-stu-id="8511b-158">Specifically:</span></span>

<span data-ttu-id="8511b-159">*"Namen können das Platzhalterzeichen \* enthalten, das als Übereinstimmung mit einer einzelnen domänennamenkomponente oder einem Komponenten Fragment angesehen wird. A.com entspricht Beispiels \*Weise foo.a.com, aber nicht Bar.foo.a.com. f\*. com entspricht foo.com, aber nicht Bar.com. "*</span><span class="sxs-lookup"><span data-stu-id="8511b-159">*"Names may contain the wildcard character \* which is considered to match any single domain name component or component fragment. E.g., \*.a.com matches foo.a.com but not bar.foo.a.com. f\*.com matches foo.com but not bar.com."*</span></span>

<span data-ttu-id="8511b-160">Wenn mehr als ein Wert in der in einer SIP-Nachricht vorgestellten Kontakt Kopfzeile vom SBC gesendet wird, wird nur der FQDN-Teil des ersten Werts des Contact-Headers verwendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-160">If more than one value in the Contact header presented in a SIP message is sent by the SBC, only the FQDN portion of the first value of the Contact header is used.</span></span>

#### <a name="request-uri"></a><span data-ttu-id="8511b-161">Request-URI</span><span class="sxs-lookup"><span data-stu-id="8511b-161">Request-URI</span></span> 

<span data-ttu-id="8511b-162">Für alle eingehenden Anrufe wird der Request-URI verwendet, um die Telefonnummer an einen Benutzer anzupassen.</span><span class="sxs-lookup"><span data-stu-id="8511b-162">For all incoming calls, the Request-URI is used to match the phone number to a user.</span></span>   

<span data-ttu-id="8511b-163">Derzeit muss die Telefonnummer ein Pluszeichen (+) enthalten, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="8511b-163">Currently The phone number must contain a plus sign (+) as shown in the following example.</span></span> 

```console
INVITE sip:+18338006777@sip.pstnhub.microsoft.com SIP /2.0
```

## <a name="contact-and-record-route-headers-considerations"></a><span data-ttu-id="8511b-164">Überlegungen zum Kontakt und Aufzeichnen von Routenkopfzeilen</span><span class="sxs-lookup"><span data-stu-id="8511b-164">Contact and Record-Route headers considerations</span></span>

<span data-ttu-id="8511b-165">Der SIP-Proxy muss den FQDN des nächsten Hop für neue in-Dialog-Clienttransaktionen berechnen (beispielsweise bye oder Re-invite) und bei der Beantwortung von SIP-Optionen.</span><span class="sxs-lookup"><span data-stu-id="8511b-165">The SIP proxy needs to calculate the next hop FQDN for new in-dialog client transactions (for example Bye or Re-Invite), and when replying to SIP Options.</span></span> <span data-ttu-id="8511b-166">Es werden entweder Kontakt-oder Daten Satz Routen verwendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-166">Either Contact or Record-Route are used.</span></span> 

<span data-ttu-id="8511b-167">Gemäß RFC 3261 ist in jeder Anforderung, die zu einem neuen Dialog führen kann, eine Kontakt Kopfzeile erforderlich.</span><span class="sxs-lookup"><span data-stu-id="8511b-167">According to RFC 3261, Contact header is required in any request that can result in a new dialog.</span></span> <span data-ttu-id="8511b-168">Die Daten Satz Route ist nur erforderlich, wenn ein Proxy den Pfad zukünftiger Anforderungen in einem Dialogfeld beibehalten möchte.</span><span class="sxs-lookup"><span data-stu-id="8511b-168">The Record-Route is only required if a proxy wants to stay on the path of future requests in a dialog.</span></span> 

<span data-ttu-id="8511b-169">Microsoft empfiehlt die Verwendung von "nur Kontakt Kopfzeile" aus den folgenden Gründen:</span><span class="sxs-lookup"><span data-stu-id="8511b-169">Microsoft recommends using only Contact header for the following reasons:</span></span>

- <span data-ttu-id="8511b-170">Pro RFC 3261 wird Record-Route verwendet, wenn ein Proxy den Pfad zukünftiger Anforderungen in einem Dialogfeld beibehalten möchte, was nicht unbedingt erforderlich ist, da der gesamte Datenverkehr zwischen dem Microsoft SIP-Proxy und dem gekoppelten SBC abläuft.</span><span class="sxs-lookup"><span data-stu-id="8511b-170">Per RFC 3261, Record-Route is used if a proxy wants to stay on the path of future requests in a dialog, which is not essential as all traffic goes between the Microsoft SIP proxy and the paired SBC.</span></span> <span data-ttu-id="8511b-171">Zwischen dem SBC und dem Microsoft SIP-Proxy ist kein zwischen Proxy Server erforderlich.</span><span class="sxs-lookup"><span data-stu-id="8511b-171">There is no need for an intermediate proxy server between the SBC and Microsoft SIP proxy.</span></span>

- <span data-ttu-id="8511b-172">Der Microsoft SIP-Proxy verwendet nur Kontakt Kopfzeile (keine Daten Satz Route), um den nächsten Hop beim Senden von ausgehenden Ping-Optionen zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="8511b-172">The Microsoft SIP proxy uses only Contact header (not Record-Route) to determine the next hop when sending outbound ping Options.</span></span> <span data-ttu-id="8511b-173">Wenn Sie nur einen Parameter (Kontakt) anstelle von zwei (Kontakt-und Daten Satz-Route) konfigurieren, wird die Verwaltung vereinfacht.</span><span class="sxs-lookup"><span data-stu-id="8511b-173">Configuring only one parameter (Contact) instead of two (Contact and Record-Route) simplifies the administration.</span></span>

<span data-ttu-id="8511b-174">Zur Berechnung des nächsten Hop verwendet der SIP-Proxy Folgendes:</span><span class="sxs-lookup"><span data-stu-id="8511b-174">To calculate the next hop, the SIP proxy uses:</span></span>

- <span data-ttu-id="8511b-175">Priorität 1</span><span class="sxs-lookup"><span data-stu-id="8511b-175">Priority 1.</span></span> <span data-ttu-id="8511b-176">Record-Route auf oberster Ebene.</span><span class="sxs-lookup"><span data-stu-id="8511b-176">Top-level Record-Route.</span></span> <span data-ttu-id="8511b-177">Wenn die Daten Satz Route auf oberster Ebene den FQDN-Namen oder die IP-Adresse enthält, wird der FQDN-Name oder die IP-Adresse verwendet, um die ausgehende in-Dialog-Verbindung herzustellen.</span><span class="sxs-lookup"><span data-stu-id="8511b-177">If the top-level Record-Route contains the FQDN name or IP, the FQDN name or IP is used to make the outbound in-dialog connection.</span></span>

- <span data-ttu-id="8511b-178">Priorität 2.</span><span class="sxs-lookup"><span data-stu-id="8511b-178">Priority 2.</span></span> <span data-ttu-id="8511b-179">Kontakt Kopfzeile.</span><span class="sxs-lookup"><span data-stu-id="8511b-179">Contact header.</span></span> <span data-ttu-id="8511b-180">Wenn Record-Route nicht vorhanden ist, sucht der SIP-Proxy nach dem Wert der Kontakt Kopfzeile, um die ausgehende Verbindung herzustellen.</span><span class="sxs-lookup"><span data-stu-id="8511b-180">If Record-Route does not exist, the SIP proxy will look up the value of the Contact header to make the outbound connection.</span></span> <span data-ttu-id="8511b-181">(Dies ist die empfohlene Konfiguration.)</span><span class="sxs-lookup"><span data-stu-id="8511b-181">(This is the recommended configuration.)</span></span>

<span data-ttu-id="8511b-182">Wenn sowohl der Kontakt als auch die Daten Satz Route verwendet werden, muss der SBC-Administrator die Werte identisch halten, was zu administrativem Overhead führt.</span><span class="sxs-lookup"><span data-stu-id="8511b-182">If both Contact and Record-Route are used, the SBC administrator must keep their values identical, which causes administrative overhead.</span></span> 

### <a name="use-of-fqdn-name-in-contact-or-record-route"></a><span data-ttu-id="8511b-183">Verwendung des FQDN-namens in Kontakt oder Daten Satz-Route</span><span class="sxs-lookup"><span data-stu-id="8511b-183">Use of FQDN name in Contact or Record-Route</span></span>

<span data-ttu-id="8511b-184">Die Verwendung einer IP-Adresse wird weder in der Daten Satz Route noch in einem Kontakt unterstützt.</span><span class="sxs-lookup"><span data-stu-id="8511b-184">Use of an IP address is not supported in either Record-Route or Contact.</span></span> <span data-ttu-id="8511b-185">Die einzige unterstützte Option ist ein FQDN, der entweder dem allgemeinen Namen oder dem alternativen Subjektnamen des SBC-Zertifikats entsprechen muss (Platzhalterwerte im Zertifikat werden unterstützt).</span><span class="sxs-lookup"><span data-stu-id="8511b-185">The only supported option is an FQDN, which must match either the Common Name or Subject Alternative Name of the SBC certificate (wildcard values in the certificate are supported).</span></span>

- <span data-ttu-id="8511b-186">Wenn eine IP-Adresse in Record-Route oder Contact angezeigt wird, schlägt die Zertifikatüberprüfung fehl, und der Anruf schlägt fehl.</span><span class="sxs-lookup"><span data-stu-id="8511b-186">If an IP address is presented in Record-route or Contact, the certificate check fails and the call fails.</span></span>

- <span data-ttu-id="8511b-187">Wenn der FQDN nicht dem Wert des allgemeinen oder Subjekt Alternativen namens im vorgestellten Zertifikat entspricht, schlägt der Aufruf fehl.</span><span class="sxs-lookup"><span data-stu-id="8511b-187">If the FQDN does not match the value of the Common or Subject Alternative Name in the presented certificate, the call fails.</span></span> 

## <a name="inbound-call-sip-dialog-description"></a><span data-ttu-id="8511b-188">Eingehendes Gespräch: Beschreibung des SIP-Dialogs</span><span class="sxs-lookup"><span data-stu-id="8511b-188">Inbound call: SIP dialog description</span></span>

<span data-ttu-id="8511b-189">In der folgenden Tabelle sind die Unterschiede bei den Anruf strömen und die Ähnlichkeiten zwischen nicht-Bypass-und Bypass-Modi zusammengefasst:</span><span class="sxs-lookup"><span data-stu-id="8511b-189">The following table below summarizes the call flow differences and similarities between non-bypass and bypass modes:</span></span>

| <span data-ttu-id="8511b-190">Parameter Name</span><span class="sxs-lookup"><span data-stu-id="8511b-190">Parameter name</span></span> | <span data-ttu-id="8511b-191">Nicht-Bypass-Modus</span><span class="sxs-lookup"><span data-stu-id="8511b-191">Non-bypass mode</span></span> | <span data-ttu-id="8511b-192">Bypass-Modus</span><span class="sxs-lookup"><span data-stu-id="8511b-192">Bypass mode</span></span>
| :---------------------  |:---------------------- |:----------------|
| <span data-ttu-id="8511b-193">Medien Kandidaten in 183-und 200-Nachrichten von</span><span class="sxs-lookup"><span data-stu-id="8511b-193">Media candidates in 183 and 200 messages coming from</span></span> | <span data-ttu-id="8511b-194">Medien Prozessoren</span><span class="sxs-lookup"><span data-stu-id="8511b-194">Media processors</span></span> | <span data-ttu-id="8511b-195">Clients</span><span class="sxs-lookup"><span data-stu-id="8511b-195">Clients</span></span> | 
| <span data-ttu-id="8511b-196">Anzahl von 183-Nachrichten, die SBC empfangen kann</span><span class="sxs-lookup"><span data-stu-id="8511b-196">Number of 183 messages SBC can receive</span></span> | <span data-ttu-id="8511b-197">Eine pro Sitzung</span><span class="sxs-lookup"><span data-stu-id="8511b-197">One per session</span></span> | <span data-ttu-id="8511b-198">Mehrere</span><span class="sxs-lookup"><span data-stu-id="8511b-198">Multiple</span></span> | 
| <span data-ttu-id="8511b-199">Anruf kann mit provisorischer Antwort erfolgen (183)</span><span class="sxs-lookup"><span data-stu-id="8511b-199">Call can be with provisional answer (183)</span></span> | <span data-ttu-id="8511b-200">Ja</span><span class="sxs-lookup"><span data-stu-id="8511b-200">Yes</span></span> | <span data-ttu-id="8511b-201">Ja</span><span class="sxs-lookup"><span data-stu-id="8511b-201">Yes</span></span> |
| <span data-ttu-id="8511b-202">Der Anruf kann ohne provisorische Antwort erfolgen (183)</span><span class="sxs-lookup"><span data-stu-id="8511b-202">Call can be without provisional answer (183)</span></span> | <span data-ttu-id="8511b-203">Ja</span><span class="sxs-lookup"><span data-stu-id="8511b-203">Yes</span></span> | <span data-ttu-id="8511b-204">Ja</span><span class="sxs-lookup"><span data-stu-id="8511b-204">Yes</span></span> |

###  <a name="non-media-bypass-flow"></a><span data-ttu-id="8511b-205">Nicht-Medien-Bypass-Flow</span><span class="sxs-lookup"><span data-stu-id="8511b-205">Non-media bypass flow</span></span>

<span data-ttu-id="8511b-206">Ein Team Benutzer hat möglicherweise mehrere Endpunkte zur gleichen Zeit.</span><span class="sxs-lookup"><span data-stu-id="8511b-206">A Teams user might have multiple endpoints at the same time.</span></span> <span data-ttu-id="8511b-207">Beispiel: Teams für Windows-Client, Teams für iPhone-Client und Teams (Android-Client).</span><span class="sxs-lookup"><span data-stu-id="8511b-207">For example, Teams for Windows client, Teams for iPhone client, and Teams Phone (Teams Android client).</span></span> <span data-ttu-id="8511b-208">Jeder Endpunkt kann einen HTTP-Ruhezustand wie folgt signalisieren:</span><span class="sxs-lookup"><span data-stu-id="8511b-208">Each endpoint might signal an HTTP rest as follows:</span></span>

-   <span data-ttu-id="8511b-209">Anruf Fortschritt – wird vom SIP-Proxy in die SIP-Nachricht 180 konvertiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-209">Call progress – converted by the SIP proxy to the SIP message 180.</span></span> <span data-ttu-id="8511b-210">Beim Empfangen von Nachrichten 180 muss der SBC lokales Klingeln generieren.</span><span class="sxs-lookup"><span data-stu-id="8511b-210">On receiving message 180, the SBC must generate local ringing.</span></span>

-   <span data-ttu-id="8511b-211">Medien Antwort – wird vom SIP-Proxy in Nachricht 183 mit Medien Kandidaten in Session Description Protocol (SDP) konvertiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-211">Media answer – converted by the SIP proxy to message 183 with media candidates in Session Description Protocol (SDP).</span></span> <span data-ttu-id="8511b-212">Beim Empfangen von Nachrichten 183 erwartet der SBC, dass eine Verbindung mit den in der SDP-Nachricht empfangenen Medien Kandidaten hergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="8511b-212">On receiving message 183, the SBC expects to connect to the media candidates received in the SDP message.</span></span> <span data-ttu-id="8511b-213">Beachten Sie, dass die Medien Antwort in einigen Fällen möglicherweise nicht generiert wird und der Endpunkt mit der Nachricht "Anruf angenommen" beantwortet werden kann.</span><span class="sxs-lookup"><span data-stu-id="8511b-213">Note that in some cases the Media answer might not be generated, and the end point might answer with “Call Accepted” message.</span></span>

-   <span data-ttu-id="8511b-214">Anruf angenommen – wird vom SIP-Proxy in SIP-Nachricht 200 mit SDP konvertiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-214">Call accepted – converted by the SIP proxy to SIP message 200 with SDP.</span></span> <span data-ttu-id="8511b-215">Beim Empfangen von Nachrichten 200 wird von SBC erwartet, dass Sie Medien an und von den bereitgestellten SDP-Kandidaten senden und empfangen.</span><span class="sxs-lookup"><span data-stu-id="8511b-215">On receiving message 200, the SBC is expected to send and receive media to and from the provided SDP candidates.</span></span>

#### <a name="multiple-endpoints-ringing-with-provisional-answer"></a><span data-ttu-id="8511b-216">Mehrere Endpunkte läuten mit provisorischer Antwort</span><span class="sxs-lookup"><span data-stu-id="8511b-216">Multiple endpoints ringing with provisional answer</span></span>

1.  <span data-ttu-id="8511b-217">Beim Empfang der ersten Einladung vom SBC sendet der SIP-Proxy die Nachricht "SIP SIP/2.0 100 trying" und benachrichtigt alle Endbenutzer-Endpunkte über den eingehenden Anruf.</span><span class="sxs-lookup"><span data-stu-id="8511b-217">On receiving the first Invite from the SBC, the SIP proxy sends the message "SIP SIP/2.0 100 Trying" and notifies all end user endpoints about the incoming call.</span></span> 

2.  <span data-ttu-id="8511b-218">Nach der Benachrichtigung beginnt jeder Endpunkt mit dem Klingeln und dem Senden von "Anruf Fortschritt"-Nachrichten an den SIP-Proxy.</span><span class="sxs-lookup"><span data-stu-id="8511b-218">Upon notification, each endpoint will start ringing and sending "Call progress” messages to the SIP proxy.</span></span> <span data-ttu-id="8511b-219">Da ein Teams-Benutzer mehrere Endpunkte haben kann, erhält der SIP-Proxy möglicherweise mehrere Statusmeldungen für den Anruf.</span><span class="sxs-lookup"><span data-stu-id="8511b-219">Because a Teams user can have multiple end points, the SIP proxy might receive multiple Call Progress messages.</span></span>

3.  <span data-ttu-id="8511b-220">Für jede Nachricht, die der Anruf Fortschritt von den Clients erhält, wandelt der SIP-Proxy die Meldung "Anruf Fortschritt" in die SIP-Nachricht "SIP SIP/2.0 180 trying" um.</span><span class="sxs-lookup"><span data-stu-id="8511b-220">For every Call Progress message received from the clients, the SIP proxy converts the Call Progress message to the SIP message "SIP SIP/2.0 180 Trying".</span></span> <span data-ttu-id="8511b-221">Das Intervall für das Senden solcher Nachrichten wird durch das Intervall der empfangenden Nachrichten vom Anruf Controller definiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-221">The interval for sending such messages is defined by the interval of the receiving messages from the Call Controller.</span></span> <span data-ttu-id="8511b-222">Im folgenden Diagramm sind 2 180-Nachrichten vom SIP-Proxy generiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-222">In the following diagram, there are two 180 messages generated by the SIP proxy.</span></span> <span data-ttu-id="8511b-223">Diese Nachrichten stammen von den beiden Endpunkten der Teams des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="8511b-223">These messages come from the two Teams endpoints of the user.</span></span> <span data-ttu-id="8511b-224">Die Clients verfügen jeweils über eine eindeutige Transponder-ID.</span><span class="sxs-lookup"><span data-stu-id="8511b-224">The clients each have a unique Tag ID.</span></span>  <span data-ttu-id="8511b-225">Jede Nachricht, die von einem anderen Endpunkt stammt, ist eine separate Sitzung (der Parameter "Tag" im Feld "an" ist anders).</span><span class="sxs-lookup"><span data-stu-id="8511b-225">Every message coming from a different endpoint will be a separate session (the parameter “tag” in the “To” field will be different).</span></span> <span data-ttu-id="8511b-226">Ein Endpunkt generiert aber möglicherweise keine Nachricht 180 und sendet Sofortnachricht 183, wie in der nachstehenden Abbildung gezeigt.</span><span class="sxs-lookup"><span data-stu-id="8511b-226">But an endpoint might not generate message 180 and send message 183 right away as shown in the following diagram.</span></span>

4.  <span data-ttu-id="8511b-227">Nachdem ein Endpunkt eine Medien Antwortnachricht mit den IP-Adressen der Medien Kandidaten des Endpunkts generiert hat, wandelt der SIP-Proxy die empfangene Nachricht in die Meldung "SIP 183-Sitzungs Fortschritt" um, wobei die SDP vom Client durch die SDP vom medienprozessor ersetzt wurde.</span><span class="sxs-lookup"><span data-stu-id="8511b-227">Once an endpoint generates a Media Answer message with the IP addresses of endpoint’s media candidates, the SIP proxy converts the message received to a "SIP 183 Session Progress" message with the SDP from the client replaced by the SDP from the Media Processor.</span></span> <span data-ttu-id="8511b-228">Im folgenden Diagramm hat der Endpunkt von Fork 2 den Anruf beantwortet.</span><span class="sxs-lookup"><span data-stu-id="8511b-228">In the following diagram, the endpoint from Fork 2 answered the call.</span></span> <span data-ttu-id="8511b-229">Wenn der trunk nicht umgangen wird, wird die 183-SIP-Nachricht nur einmal generiert (entweder Ring-bot oder Client-Endpunkt).</span><span class="sxs-lookup"><span data-stu-id="8511b-229">If the trunk is non-bypassed, the 183 SIP message is generated only once (either Ring Bot or Client End Point).</span></span> <span data-ttu-id="8511b-230">Die 183 kann auf eine vorhandene Verzweigung oder auf eine neue Gabel fallen.</span><span class="sxs-lookup"><span data-stu-id="8511b-230">The 183 might come on an existing fork or start a new one.</span></span>

5.  <span data-ttu-id="8511b-231">Eine Anrufannahme Nachricht wird mit den endgültigen Kandidaten des Endpunkts gesendet, der den Anruf angenommen hat.</span><span class="sxs-lookup"><span data-stu-id="8511b-231">A Call Acceptance message is sent with the final candidates of the endpoint that accepted the call.</span></span> <span data-ttu-id="8511b-232">Die Anrufannahme Nachricht wird in SIP-Nachricht 200 konvertiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-232">The Call Acceptance message is converted to SIP message 200.</span></span> 

![Diagramm, das zeigt, dass mehrere Endpunkte mit provisorischer Antwort Klingeln](media/direct-routing-protocols-1.png)

#### <a name="multiple-endpoints-ringing-without-provisional-answer"></a><span data-ttu-id="8511b-234">Mehrere Endpunkte Klingeln ohne provisorische Antwort</span><span class="sxs-lookup"><span data-stu-id="8511b-234">Multiple endpoints ringing without provisional answer</span></span>

1.  <span data-ttu-id="8511b-235">Beim Empfang der ersten Einladung vom SBC sendet der SIP-Proxy die Nachricht "SIP SIP/2.0 100 trying" und benachrichtigt alle Endbenutzer-Endpunkte über den eingehenden Anruf.</span><span class="sxs-lookup"><span data-stu-id="8511b-235">On receiving the first Invite from the SBC, the SIP proxy sends the message "SIP SIP/2.0 100 Trying" and notifies all end user endpoints about the incoming call.</span></span> 

2.  <span data-ttu-id="8511b-236">Nach der Benachrichtigung beginnt jeder Endpunkt mit dem Klingeln und dem Senden der Nachricht "Anruf Fortschritt" an den SIP-Proxy.</span><span class="sxs-lookup"><span data-stu-id="8511b-236">Upon notification, each endpoint will start ringing and sending the message "Call progress” to the SIP proxy.</span></span> <span data-ttu-id="8511b-237">Da ein Teams-Benutzer mehrere Endpunkte haben kann, erhält der SIP-Proxy möglicherweise mehrere Statusmeldungen für den Anruf.</span><span class="sxs-lookup"><span data-stu-id="8511b-237">Because a Teams user can have multiple end points, the SIP proxy might receive multiple Call Progress messages.</span></span>

3.  <span data-ttu-id="8511b-238">Für jede Nachricht, die der Anruf Fortschritt von den Clients erhält, wandelt der SIP-Proxy die Meldung "Anruf Fortschritt" in die SIP-Nachricht "SIP SIP/2.0 180 trying" um.</span><span class="sxs-lookup"><span data-stu-id="8511b-238">For every Call Progress message received from the clients, the SIP proxy converts the Call Progress message to the SIP message "SIP SIP/2.0 180 Trying".</span></span>  <span data-ttu-id="8511b-239">Das Intervall für das Senden der Nachrichten wird durch das Intervall definiert, in dem die Nachrichten vom Anruf Controller empfangen werden.</span><span class="sxs-lookup"><span data-stu-id="8511b-239">The interval for sending the messages is defined by the interval of receiving the messages from the Call Controller.</span></span> <span data-ttu-id="8511b-240">Auf dem Bild unten sind 2 180 vom SIP-Proxy generierte Nachrichten, was bedeutet, dass der Benutzer sich bei drei Teams-Clients angemeldet hat und jeder Client den Anruf Fortschritt sendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-240">On the picture below there are two 180 messages generated by the SIP proxy, meaning that user logged into three Teams clients and each client send the call progress.</span></span> <span data-ttu-id="8511b-241">Jede Nachricht wird eine separate Sitzung sein (der Parameter "Tag" im Feld "an" ist anders)</span><span class="sxs-lookup"><span data-stu-id="8511b-241">Every message will be a separate session (parameter “tag” in “To” field is different)</span></span>

4.  <span data-ttu-id="8511b-242">Eine Anrufannahme Nachricht wird mit den endgültigen Kandidaten des Endpunkts gesendet, der den Anruf angenommen hat.</span><span class="sxs-lookup"><span data-stu-id="8511b-242">A Call Acceptance message is sent with the final candidates of the endpoint that accepted the call.</span></span> <span data-ttu-id="8511b-243">Die Anrufannahme Nachricht wird in SIP-Nachricht 200 konvertiert.</span><span class="sxs-lookup"><span data-stu-id="8511b-243">The Call Acceptance message is converted to SIP message 200.</span></span> 

![Diagramm mit mehreren Endpunkten, die ohne provisorische Antwort Klingeln](media/direct-routing-protocols-2.png)

### <a name="media-bypass-flow"></a><span data-ttu-id="8511b-245">Medien Umgehungs Fluss</span><span class="sxs-lookup"><span data-stu-id="8511b-245">Media bypass flow</span></span>

<span data-ttu-id="8511b-246">Die gleichen Nachrichten (100 versuchen, 180, 183) werden im Szenario "medienumgehung" verwendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-246">The same messages (100 Trying, 180, 183) are used in the media bypass scenario.</span></span> 

<span data-ttu-id="8511b-247">Das folgende Schema zeigt ein Beispiel für den Bypass-Anruffluss.</span><span class="sxs-lookup"><span data-stu-id="8511b-247">The schema below shows an example of the bypass call flow.</span></span> <span data-ttu-id="8511b-248">Beachten Sie, dass die Medien Kandidaten von unterschiedlichen Endpunkten stammen können.</span><span class="sxs-lookup"><span data-stu-id="8511b-248">Note that the media candidates can come from different endpoints.</span></span> 

![Diagramm, das zeigt, dass mehrere Endpunkte mit provisorischer Antwort Klingeln](media/direct-routing-protocols-3.png)

## <a name="replaces-option"></a><span data-ttu-id="8511b-250">Option ersetzt</span><span class="sxs-lookup"><span data-stu-id="8511b-250">Replaces option</span></span>

<span data-ttu-id="8511b-251">Der SBC muss invite mit ersetzt unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8511b-251">The SBC must support Invite with Replaces.</span></span>

## <a name="size-of-sdp-considerations"></a><span data-ttu-id="8511b-252">Größe von SDP-Überlegungen</span><span class="sxs-lookup"><span data-stu-id="8511b-252">Size of SDP considerations</span></span>

<span data-ttu-id="8511b-253">Die direkte Routing Schnittstelle kann eine SIP-Nachricht senden, die 1.500 Bytes überschreitet.</span><span class="sxs-lookup"><span data-stu-id="8511b-253">The Direct Routing interface might send a SIP message exceeding 1,500 bytes.</span></span>  <span data-ttu-id="8511b-254">Die Größe von SDP führt in erster Linie dazu.</span><span class="sxs-lookup"><span data-stu-id="8511b-254">The size of SDP primarily causes this.</span></span> <span data-ttu-id="8511b-255">Wenn jedoch ein UDP-Stamm hinter dem SBC vorhanden ist, wird die Nachricht möglicherweise zurückgewiesen, wenn Sie vom Microsoft SIP-Proxy an den Stamm unverändert weitergeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="8511b-255">However, if there is a UDP trunk behind the SBC, it might reject the message if it is forwarded from the Microsoft SIP proxy to the trunk unmodified.</span></span> <span data-ttu-id="8511b-256">Microsoft empfiehlt, beim Senden der Nachricht an die UDP-Stämme einige Werte in SDP auf dem SBC zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="8511b-256">Microsoft recommends stripping some values in SDP on the SBC when sending the message to the UDP trunks.</span></span> <span data-ttu-id="8511b-257">Beispielsweise können die Ice-Kandidaten oder nicht verwendete Codecs entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="8511b-257">For example, the ICE candidates or unused codecs can be removed.</span></span>

## <a name="call-transfer"></a><span data-ttu-id="8511b-258">Anrufübertragung</span><span class="sxs-lookup"><span data-stu-id="8511b-258">Call transfer</span></span>

<span data-ttu-id="8511b-259">Direct Routing unterstützt zwei Methoden für die Anrufweiterleitung:</span><span class="sxs-lookup"><span data-stu-id="8511b-259">Direct Routing supports two methods for call transfer:</span></span>

- <span data-ttu-id="8511b-260">Option 1.</span><span class="sxs-lookup"><span data-stu-id="8511b-260">Option 1.</span></span> <span data-ttu-id="8511b-261">SIP-Proxy Prozesse verweisen vom Client lokal und fungieren als Schiedsrichter, wie in Abschnitt 7,1 von RFC 3892 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8511b-261">SIP proxy processes Refer from the client locally and acts as a Referee as described in section 7.1 of RFC 3892.</span></span>

  <span data-ttu-id="8511b-262">Mit dieser Option beendet der SIP-Proxy die Übertragung und fügt eine neue Einladung hinzu.</span><span class="sxs-lookup"><span data-stu-id="8511b-262">With this option, the SIP proxy terminates the transfer and adds a new Invite.</span></span> 


- <span data-ttu-id="8511b-263">Option 2.</span><span class="sxs-lookup"><span data-stu-id="8511b-263">Option 2.</span></span> <span data-ttu-id="8511b-264">Der SIP-Proxy sendet den Verweis an den SBC und fungiert als Übertragung, wie er in Abschnitt 6 von RFC 5589 beschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="8511b-264">SIP proxy sends the Refer to the SBC and acts as a Transferor as describing in Section 6 of RFC 5589.</span></span>

  <span data-ttu-id="8511b-265">Mit dieser Option sendet der SIP-Proxy einen Verweis auf den SBC und erwartet, dass der SBC die Übertragung vollständig übernimmt.</span><span class="sxs-lookup"><span data-stu-id="8511b-265">With this option, the SIP proxy sends a Refer to the SBC and expects the SBC to handle the Transfer fully.</span></span>

<span data-ttu-id="8511b-266">Der SIP-Proxy wählt die Methode basierend auf den vom SBC gemeldeten Funktionen aus.</span><span class="sxs-lookup"><span data-stu-id="8511b-266">The SIP proxy selects the method based on the capabilities reported by the SBC.</span></span> <span data-ttu-id="8511b-267">Wenn der SBC angibt, dass die Methode "Refer" unterstützt wird, verwendet der SIP-Proxy Option 2 für Anruf Übertragungen.</span><span class="sxs-lookup"><span data-stu-id="8511b-267">If the SBC indicates that it supports the method “Refer”, the SIP proxy will use Option 2 for call transfers.</span></span>

<span data-ttu-id="8511b-268">Der folgende Code ist ein Beispiel für einen SBC, der die Nachricht sendet, dass die Refer-Methode unterstützt wird:</span><span class="sxs-lookup"><span data-stu-id="8511b-268">The following is an example of an SBC sending the message that the Refer method is supported:</span></span>

```console
ALLOW: INVITE, OPTIONS, INFO, BYE, CANCEL, ACK, PRACK, UPDATE, REFER, SUBSCRIBE, NOTIFY
```

<span data-ttu-id="8511b-269">Wenn der SBC nicht angibt, dass es sich um eine unterstützte Methode handelt, verwendet das direkte Routing die Option 1 (SIP-Proxy fungiert als Schiedsrichter).</span><span class="sxs-lookup"><span data-stu-id="8511b-269">If the SBC doesn’t indicate that Refer as a supported method, Direct Routing will use Option 1 (SIP proxy acts as a Referee) .</span></span> <span data-ttu-id="8511b-270">Der SBC muss auch signalisieren, dass er die Notify-Methode unterstützt:</span><span class="sxs-lookup"><span data-stu-id="8511b-270">The SBC  must also signal that it supports the Notify method:</span></span>

<span data-ttu-id="8511b-271">Beispiel für SBC, der angibt, dass die Refer-Methode nicht unterstützt wird:</span><span class="sxs-lookup"><span data-stu-id="8511b-271">Example of SBC indicating that Refer method is not supported:</span></span>

```console
ALLOW: INVITE, ACK, CANCEL, BYE, INFO, NOTIFY, PRACK, UPDATE, OPTIONS
```

### <a name="sip-proxy-processes-refer-from-the-client-locally-and-acts-as-a-referee"></a><span data-ttu-id="8511b-272">SIP-Proxy Prozesse verweisen vom Client lokal und fungieren als Schiedsrichter</span><span class="sxs-lookup"><span data-stu-id="8511b-272">SIP proxy processes Refer from the client locally and acts as a Referee</span></span>

<span data-ttu-id="8511b-273">Wenn der SBC angegeben hat, dass die Refer-Methode nicht unterstützt wird, fungiert der SIP-Proxy als Schiedsrichter.</span><span class="sxs-lookup"><span data-stu-id="8511b-273">If the SBC indicated that the Refer method is not supported, the SIP proxy acts as a Referee.</span></span> 

<span data-ttu-id="8511b-274">Die Refer-Anfrage, die vom Client stammt, wird auf dem SIP-Proxy beendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-274">The Refer request that comes from the client will be terminated on the SIP proxy.</span></span> <span data-ttu-id="8511b-275">(Die Refer-Anfrage des Clients wird im folgenden Diagramm als "Anrufübertragung an Dave" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="8511b-275">(The Refer request from the client is shown as “Call transfer to Dave” in the following diagram.</span></span>  <span data-ttu-id="8511b-276">Weitere Informationen finden Sie in Abschnitt 7,1 von [RFC 3892](https://www.ietf.org/rfc/rfc3892.txt).</span><span class="sxs-lookup"><span data-stu-id="8511b-276">For more information, see section 7.1 of [RFC 3892](https://www.ietf.org/rfc/rfc3892.txt).</span></span> 

![Diagramm, das zeigt, dass mehrere Endpunkte mit provisorischer Antwort Klingeln](media/direct-routing-protocols-4.png)

### <a name="sip-proxy-send-the-refer-to-the-sbc-and-acts-as-a-transferor"></a><span data-ttu-id="8511b-278">SIP-Proxy senden Sie den Verweis an den SBC und fungiert als übertragender.</span><span class="sxs-lookup"><span data-stu-id="8511b-278">SIP proxy send the Refer to the SBC and acts as a Transferor</span></span>

<span data-ttu-id="8511b-279">Dies ist die bevorzugte Methode für Anruf Übertragungen und für Geräte, die eine Medien Umgehungs Zertifizierung suchen, obligatorisch.</span><span class="sxs-lookup"><span data-stu-id="8511b-279">This is the preferred method for call transfers, and it is mandatory for devices seeking media bypass certification.</span></span> <span data-ttu-id="8511b-280">Die Anrufübertragung, ohne dass der SBC-Verweis verarbeitet werden kann, wird im Medien Umgehungsmodus nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="8511b-280">Call Transfer without the SBC being able to handle Refer is not supported in media bypass mode.</span></span> 

<span data-ttu-id="8511b-281">Der Standard wird in Abschnitt 6 von RFC 5589 erläutert.</span><span class="sxs-lookup"><span data-stu-id="8511b-281">The standard is explained in Section 6 of RFC 5589.</span></span> <span data-ttu-id="8511b-282">Die zugehörigen RFCs sind:</span><span class="sxs-lookup"><span data-stu-id="8511b-282">The related RFCs are:</span></span>

- [<span data-ttu-id="8511b-283">SIP-Anrufsteuerung (Session Initiation Protocol) – Übertragung</span><span class="sxs-lookup"><span data-stu-id="8511b-283">Session Initiation Protocol (SIP) Call Control - Transfer</span></span>](https://tools.ietf.org/html/rfc5589)

- [<span data-ttu-id="8511b-284">SIP-Header (Session Initiation Protocol) "ersetzt"</span><span class="sxs-lookup"><span data-stu-id="8511b-284">Session Initiation Protocol (SIP) "Replaces" Header</span></span>](https://tools.ietf.org/html/rfc3891)

- [<span data-ttu-id="8511b-285">SIP-Mechanismus (Session Initiation Protocol)</span><span class="sxs-lookup"><span data-stu-id="8511b-285">Session Initiation Protocol (SIP) "Referred-By" mechanism</span></span>](https://tools.ietf.org/html/rfc3892)

<span data-ttu-id="8511b-286">Bei dieser Option wird davon ausgegangen, dass der SIP-Proxy als Übertragung fungiert und eine Refer-Meldung an den SBC sendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-286">This option assumes that the SIP proxy acts as a Transferor and sends a Refer message to the SBC.</span></span> <span data-ttu-id="8511b-287">Der SBC fungiert als übertragender und behandelt das Verweis auf ein neues Angebot für die Übertragung zu generieren.</span><span class="sxs-lookup"><span data-stu-id="8511b-287">The SBC acts as a Transferee and handles the Refer to generate a new offer for transfer.</span></span> <span data-ttu-id="8511b-288">Es gibt zwei mögliche Fälle:</span><span class="sxs-lookup"><span data-stu-id="8511b-288">There are two possible cases:</span></span>

- <span data-ttu-id="8511b-289">Der Anruf wird an einen externen PSTN-Teilnehmer übertragen.</span><span class="sxs-lookup"><span data-stu-id="8511b-289">The call is transferred to an external PSTN participant.</span></span> 
- <span data-ttu-id="8511b-290">Der Anruf wird von einem Teams-Benutzer an einen anderen Teams-Benutzer im gleichen Mandanten über den SBC übertragen.</span><span class="sxs-lookup"><span data-stu-id="8511b-290">The call is transferred from one Teams user to another Teams user in the same tenant via the SBC.</span></span> 

<span data-ttu-id="8511b-291">Wenn der Anruf über den SBC von einem Teams-Benutzer zu einem anderen übertragen wird, wird erwartet, dass der SBC eine neue Einladung (ein neues Dialogfeld) für das Übergabeziel (den Teams-Benutzer) mit den in der Refer-Nachricht erhaltenen Informationen ausgibt.</span><span class="sxs-lookup"><span data-stu-id="8511b-291">If the call is transferred from one Teams user to another via the SBC, the SBC is expected to issue a new invite (start a new dialog) for the transfer target (the Teams user) using the information received in the Refer message.</span></span> 

<span data-ttu-id="8511b-292">Um die Felder an/übertragen für die Transaktion der Anforderung intern zu füllen, muss der SIP-Proxy diese Informationen innerhalb der Verweis-zu/Verweis-Überschriften übermitteln.</span><span class="sxs-lookup"><span data-stu-id="8511b-292">To populate the To/Transferor fields for the transaction of the request internally, the SIP proxy needs to convey this information  inside the REFER-TO/REFERRED-BY headers.</span></span> 

<span data-ttu-id="8511b-293">Der SIP-Proxy stellt den Verweis als SIP-URI dar, der aus einem SIP-Proxy-FQDN im Hostname und einer der folgenden besteht:</span><span class="sxs-lookup"><span data-stu-id="8511b-293">The SIP proxy will form the REFER-TO as a SIP URI comprised of a SIP proxy FQDN in the hostname and either one of the following:</span></span>

- <span data-ttu-id="8511b-294">Eine E. 164-Telefonnummer im username-Teil des URIs, falls es sich bei dem Übertragungsziel um eine Telefonnummer handelt, oder</span><span class="sxs-lookup"><span data-stu-id="8511b-294">An E.164 phone number in the username part of the URI in case the transfer target is a phone number, or</span></span>

- <span data-ttu-id="8511b-295">x-m-und x-t-Parameter, die das vollständige Übertragungsziel-MRI und die Mandanten-ID codieren</span><span class="sxs-lookup"><span data-stu-id="8511b-295">x-m and x-t parameters encoding the full transfer target MRI and tenant ID respectively</span></span> 

<span data-ttu-id="8511b-296">Der verweisende Header ist ein SIP-URI, in dem das in ihm codierte MRI-MRT sowie die Mandanten-ID des Verweisers und andere Parameter des Übertragungs Kontexts, wie in der folgenden Tabelle dargestellt, aufgeführt sind:</span><span class="sxs-lookup"><span data-stu-id="8511b-296">The REFERRED-BY header is a SIP URI with transferor MRI encoded in it as well as transferor tenant ID and other transfer context parameters as shown in the following table:</span></span>

| <span data-ttu-id="8511b-297">Parameter</span><span class="sxs-lookup"><span data-stu-id="8511b-297">Parameter</span></span> | <span data-ttu-id="8511b-298">Wert</span><span class="sxs-lookup"><span data-stu-id="8511b-298">Value</span></span> | <span data-ttu-id="8511b-299">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="8511b-299">Description</span></span> |  
|:---------------------  |:---------------------- |:---------------------- |
| <span data-ttu-id="8511b-300">x-m</span><span class="sxs-lookup"><span data-stu-id="8511b-300">x-m</span></span> | <span data-ttu-id="8511b-301">MRI</span><span class="sxs-lookup"><span data-stu-id="8511b-301">MRI</span></span> | <span data-ttu-id="8511b-302">Vollständiges MRI des übertragenden/übertragenden Ziels als von CC ausgefüllt</span><span class="sxs-lookup"><span data-stu-id="8511b-302">Full MRI of transferor/transfer target as populated by CC</span></span> |
| <span data-ttu-id="8511b-303">x-t</span><span class="sxs-lookup"><span data-stu-id="8511b-303">x-t</span></span> | <span data-ttu-id="8511b-304">Mandanten-ID</span><span class="sxs-lookup"><span data-stu-id="8511b-304">Tenant ID</span></span> | <span data-ttu-id="8511b-305">x-t-Mandanten-ID optionale Mandanten-ID, wie von CC ausgefüllt</span><span class="sxs-lookup"><span data-stu-id="8511b-305">x-t Tenant ID Optional Tenant Id as populated by CC</span></span> |
| <span data-ttu-id="8511b-306">x-TI</span><span class="sxs-lookup"><span data-stu-id="8511b-306">x-ti</span></span> | <span data-ttu-id="8511b-307">Übertragungs Korrelations-ID</span><span class="sxs-lookup"><span data-stu-id="8511b-307">Transferor Correlation Id</span></span> | <span data-ttu-id="8511b-308">Korrelations-ID des Anrufs an den übertragenden</span><span class="sxs-lookup"><span data-stu-id="8511b-308">Correlation Id of the call to the transferor</span></span> |
| <span data-ttu-id="8511b-309">x-TT</span><span class="sxs-lookup"><span data-stu-id="8511b-309">x-tt</span></span> | <span data-ttu-id="8511b-310">Übertragen des Ziel Anruf-URIs</span><span class="sxs-lookup"><span data-stu-id="8511b-310">Transfer target call URI</span></span> | <span data-ttu-id="8511b-311">Codierter Anruf Ersetzungs-URI</span><span class="sxs-lookup"><span data-stu-id="8511b-311">Encoded call replacement URI</span></span> |

<span data-ttu-id="8511b-312">In diesem Fall kann die Größe des Refer-Headers bis zu 400-Symbole sein.</span><span class="sxs-lookup"><span data-stu-id="8511b-312">The size of the Refer Header can be up to 400 symbols in this case.</span></span> <span data-ttu-id="8511b-313">Der SBC muss die Behandlung von Refer-Nachrichten mit einer Größe von bis zu 400-Symbolen unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8511b-313">The SBC must support handling Refer messages with size up to 400 symbols.</span></span>

![Diagramm, das zeigt, dass mehrere Endpunkte mit provisorischer Antwort Klingeln](media/direct-routing-protocols-5.png)

## <a name="session-timer"></a><span data-ttu-id="8511b-315">Sitzungszeitgeber</span><span class="sxs-lookup"><span data-stu-id="8511b-315">Session timer</span></span>

<span data-ttu-id="8511b-316">Der SIP-Proxy unterstützt (immer) den Session-Timer bei nicht-Bypass-anrufen, bietet ihn aber nicht bei Bypass-Anrufen an.</span><span class="sxs-lookup"><span data-stu-id="8511b-316">The SIP proxy supports (always offers) the Session Timer on non-bypass calls but does not offer it on bypass calls.</span></span> <span data-ttu-id="8511b-317">Die Verwendung des Session-Timers durch den SBC ist nicht zwingend erforderlich.</span><span class="sxs-lookup"><span data-stu-id="8511b-317">Use of the Session Timer by the SBC is not mandatory.</span></span>

##  <a name="use-of-request-uri-parameter-userphone"></a><span data-ttu-id="8511b-318">Verwendung des Request-URI-Parameters User = Phone</span><span class="sxs-lookup"><span data-stu-id="8511b-318">Use of Request-URI parameter user=phone</span></span>

<span data-ttu-id="8511b-319">Der SIP-Proxy analysiert den Anforderungs-URI, und wenn der Parameter User = Phone vorhanden ist, behandelt der Dienst den Anforderungs-URI als eine Telefonnummer, die der Nummer eines Benutzers entspricht.</span><span class="sxs-lookup"><span data-stu-id="8511b-319">The SIP proxy analyses the Request-URI and if the parameter user=phone is present, the service will handle the Request-URI as a phone number, matching the number to a user.</span></span> <span data-ttu-id="8511b-320">Wenn Parameter nicht vorhanden ist, wendet der SIP-Proxy Heuristiken an, um den Benutzertyp Request-URI (Telefonnummer oder SIP-Adresse) zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="8511b-320">If parameter is not present the SIP proxy applies heuristics to determine  the Request-URI user type (phone number or a SIP address).</span></span>

<span data-ttu-id="8511b-321">Microsof empfiehlt immer die Anwendung des User = Phone-Parameters, um den Anruf-Setupvorgang zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="8511b-321">Microsof recommends always applying the user=phone parameter to simplify the call setup process.</span></span>

## <a name="history-info-header"></a><span data-ttu-id="8511b-322">Verlaufsinformationen-Kopfzeile</span><span class="sxs-lookup"><span data-stu-id="8511b-322">History-Info header</span></span>

<span data-ttu-id="8511b-323">Der Header "History-Info" wird für die Neuausrichtung von SIP-Anforderungen und "bereitstellen (s) eines Standardmechanismus zum Erfassen der Informationen zum Anforderungsverlauf verwendet, um eine Vielzahl von Diensten für Netzwerke und Endbenutzer zu ermöglichen."</span><span class="sxs-lookup"><span data-stu-id="8511b-323">The History-Info header is used for retargeting SIP requests and “provide(s) a standard mechanism for capturing the request history information to enable a wide variety of services for networks and end-users.”</span></span> <span data-ttu-id="8511b-324">Weitere Informationen finden Sie in [RFC 4244 – Abschnitt 1,1](http://www.ietf.org/rfc/rfc4244.txt).</span><span class="sxs-lookup"><span data-stu-id="8511b-324">For more information, see [RFC 4244 – Section 1.1](http://www.ietf.org/rfc/rfc4244.txt).</span></span> <span data-ttu-id="8511b-325">Für Microsoft Phone System wird dieser Header in Simulring-und Anruf Weiterleitungs Szenarien verwendet.</span><span class="sxs-lookup"><span data-stu-id="8511b-325">For Microsoft Phone System, this header is used in Simulring and Call Forwarding scenarios.</span></span>  

<span data-ttu-id="8511b-326">Beim Senden werden die Verlaufsinformationen wie folgt aktiviert:</span><span class="sxs-lookup"><span data-stu-id="8511b-326">If sending, the History-Info is enabled as follows:</span></span>

- <span data-ttu-id="8511b-327">Der SIP-Proxy fügt einen Parameter mit der zugehörigen Rufnummer in einzelne Verlaufs-Info-Einträge ein, die den an den PSTN-Controller gesendeten History-Info-Header enthalten.</span><span class="sxs-lookup"><span data-stu-id="8511b-327">The SIP proxy will insert a parameter containing the associated phone number in individual History-Info entries that comprise the History-Info header sent to the PSTN Controller.</span></span>  <span data-ttu-id="8511b-328">Wenn nur Einträge mit dem Parameter "Telefonnummer" verwendet werden, wird vom PSTN-Controller eine neue Verlaufsinformationen-Kopfzeile neu erstellt und über den SIP-Proxy an den SIP-Trunk-Anbieter weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="8511b-328">Using only entries that have the phone number parameter, the PSTN Controller will rebuild a new History-Info header, and pass it on to the SIP trunk provider via SIP proxy.</span></span>

- <span data-ttu-id="8511b-329">History-Info-Kopfzeile wird für simultane Klingel-und Anruf Weiterleitungs Fälle hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="8511b-329">History-Info header will be added for simultaneous ring and call forwarding cases.</span></span>

- <span data-ttu-id="8511b-330">Die Kopfzeile der Verlaufsinformationen wird nicht für Anruf Übertragungs Fälle hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="8511b-330">History-Info header will not be added for call transfer cases.</span></span>

- <span data-ttu-id="8511b-331">Bei einem individuellen Verlaufseintrag im rekonstruierten Verlaufs-Info-Header wird der Parameter für die Telefonnummer in Kombination mit dem Direct Routing-FQDN (SIP.pstnhub.Microsoft.com), der als Host-Teil des URIs festgelegt ist, bereitgestellt. ein Parameter von "User = Phone" wird als Teil des SIP-URIs hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="8511b-331">An individual history entry in the reconstructed History-Info header will have the phone number parameter provided combined with the Direct Routing FQDN (sip.pstnhub.microsoft.com) set as the host part of the URI; a parameter of ‘user=phone’ will be added as part of the SIP URI.</span></span>  <span data-ttu-id="8511b-332">Alle anderen Parameter, die mit dem ursprünglichen History-Info-Header verknüpft sind, mit Ausnahme von Telefonkontext Parametern, werden im neu konstruierten History-Info-Header durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="8511b-332">Any other parameters associated with the original History-Info header, except for phone context parameters, will be passed through in the re-constructed History-Info header.</span></span>  <span data-ttu-id="8511b-333">Beachten Sie, dass private Einträge (entsprechend den in Abschnitt 3,3 von RFC 4244 definierten Mechanismen) weitergeleitet werden, weil der SIP Trunk-Anbieter ein vertrauenswürdiger Peer ist.</span><span class="sxs-lookup"><span data-stu-id="8511b-333">Note that entries that are private (as determined by the mechanisms defined in Section 3.3 of RFC 4244) will be forwarded as is because  the SIP trunk provider is a trusted peer.</span></span>

- <span data-ttu-id="8511b-334">Eingehende Verlaufsinformationen werden ignoriert.</span><span class="sxs-lookup"><span data-stu-id="8511b-334">Inbound History-Info is ignored.</span></span>

<span data-ttu-id="8511b-335">Im folgenden wird das Format der vom SIP-Proxy gesendeten History-Info-Kopfzeile angezeigt:</span><span class="sxs-lookup"><span data-stu-id="8511b-335">Following is the format of the History-info header sent by the SIP proxy:</span></span>

```console
<sip:UserB@sip.pstnhub.microsoft.com?Privacy=history&Reason=SIP%3B\cause%3D486>;index=1.2,
```

<span data-ttu-id="8511b-336">Wenn der Anruf mehrmals umgeleitet wurde, sind Informationen zu jeder Umleitung in chronologischer Reihenfolge in den entsprechenden Grund eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="8511b-336">If the call was redirected several times, information about every redirect is included with the appropriate reason in chronological order.</span></span>


<span data-ttu-id="8511b-337">Header Beispiel:</span><span class="sxs-lookup"><span data-stu-id="8511b-337">Header Example:</span></span>

```console
History-info: 
<sip:+14257123456@sip.pstnhub.microsoft.com;user=phone?Reason=SIP;cause=302;text=”Move Temporarily”>;index=1
<sip:+14257123457@sip.pstnhub.microsoft.com;user=phone?Reason=SIP;cause=496;text=”User Busy”>;index=1.1
```

<span data-ttu-id="8511b-338">Die Verlaufsinformationen sind durch einen obligatorischen TLS-Mechanismus geschützt.</span><span class="sxs-lookup"><span data-stu-id="8511b-338">The History-Info is protected by a mandatory TLS mechanism.</span></span> 

## <a name="sbc-connection-to-direct-routing-and-failover-mechanism"></a><span data-ttu-id="8511b-339">SBC-Verbindung mit Direct Routing und Failover-Mechanismus</span><span class="sxs-lookup"><span data-stu-id="8511b-339">SBC connection to Direct Routing and failover mechanism</span></span>

<span data-ttu-id="8511b-340">Lesen Sie den Abschnitt Failover-Mechanismus für SIP-Signalisierungen in [Plan für das direkte Routing](direct-routing-plan.md#failover-mechanism-for-sip-signaling).</span><span class="sxs-lookup"><span data-stu-id="8511b-340">See the section Failover mechanism for SIP signaling in [Plan for Direct Routing](direct-routing-plan.md#failover-mechanism-for-sip-signaling).</span></span>

## <a name="retry-after"></a><span data-ttu-id="8511b-341">Wiederholen-nachher</span><span class="sxs-lookup"><span data-stu-id="8511b-341">Retry-After</span></span>

<span data-ttu-id="8511b-342">Wenn ein direktes Routing-Rechenzentrum ausgelastet ist, kann der Dienst eine Retry-after-Nachricht mit einem Sekunden Intervall an den SBC senden.</span><span class="sxs-lookup"><span data-stu-id="8511b-342">If a Direct Routing datacenter is busy, the service can send a Retry-After message with a one-second interval to the SBC.</span></span> <span data-ttu-id="8511b-343">Wenn der SBC eine 503-Nachricht mit einem Retry-after-Header als Antwort auf eine Einladung erhält, muss der SBC diese Verbindung kündigen und das nächste verfügbare Microsoft Datacenter testen.</span><span class="sxs-lookup"><span data-stu-id="8511b-343">When the SBC receives a 503 message with a Retry-After header in response to an INVITE, the SBC must terminate that connection and try the next available Microsoft datacenter.</span></span> 

## <a name="ice-restart-media-bypass-call-transferred-to-an-endpoint-that-does-not-support-media-bypass"></a><span data-ttu-id="8511b-344">Ice-Neustart: Medien Umgehungs Anruf wird an einen Endpunkt übertragen, der keine medienumgehung unterstützt</span><span class="sxs-lookup"><span data-stu-id="8511b-344">ICE Restart: Media bypass call transferred to an endpoint that does not support media bypass</span></span>

<span data-ttu-id="8511b-345">Der SBC muss Ice-Neustarts unterstützen, wie in [RFC 5245, Abschnitt 9.1.1.1](https://tools.ietf.org/html/rfc5245#section-9.1.1.1)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8511b-345">The SBC must support ICE restarts as described in [RFC 5245, section 9.1.1.1](https://tools.ietf.org/html/rfc5245#section-9.1.1.1).</span></span>

<span data-ttu-id="8511b-346">Der Neustart beim direkten Routing wird gemäß den folgenden Absätzen der RFC implementiert:</span><span class="sxs-lookup"><span data-stu-id="8511b-346">The restart in Direct Routing is implemented according to the following paragraphs of the RFC:</span></span>

<span data-ttu-id="8511b-347">*Um Ice neu zu starten, muss ein Agent sowohl das Ice-pwd als auch das Ice-ufrag für den Mediendatenstrom in einem Angebot ändern.  Beachten Sie, dass es zulässig ist, in einem Angebot ein Attribut auf Sitzungsebene zu verwenden, aber das gleiche Ice-pwd-oder Ice-ufrag-Attribut in einem nachfolgenden Angebot als Attribut auf Medienebene bereitzustellen.  Hierbei handelt es sich nicht um eine Änderung des Kennworts, sondern nur um eine Änderung der Darstellung, und es wird kein Ice-Neustart verursacht.*</span><span class="sxs-lookup"><span data-stu-id="8511b-347">*To restart ICE, an agent MUST change both the ice-pwd and the ice-ufrag for the media stream in an offer.  Note that it is permissible to use a session-level attribute in one offer, but to provide the same ice-pwd or ice-ufrag as a media-level attribute in a subsequent offer.  This is not a change in password, just a change in its representation, and does not cause an ICE restart.*</span></span>

<span data-ttu-id="8511b-348">*Ein Agent legt die restlichen Felder im SDP für diesen Mediendatenstrom so fest, wie dies bei einem anfänglichen Angebot dieses Mediendatenstroms der Fall wäre (siehe Abschnitt 4,3).  Infolgedessen kann die Gruppe von Kandidaten einige, keine oder alle vorherigen Kandidaten für diesen Datenstrom enthalten und eine völlig neue Gruppe von Kandidaten enthalten, wie in Abschnitt 4.1.1 beschrieben.*</span><span class="sxs-lookup"><span data-stu-id="8511b-348">*An agent sets the rest of the fields in the SDP for this media stream as it would in an initial offer of this media stream (see Section 4.3).  Consequently, the set of candidates MAY include some, none, or all of the previous candidates for that stream and MAY include a totally new set of candidates gathered as described in Section 4.1.1.*</span></span>

<span data-ttu-id="8511b-349">Wenn der Anruf zunächst mit Media Bypass eingerichtet wurde und der Anruf an einen Skype for Business-Client übertragen wird, muss das direkte Routing einen medienprozessor einfügen – Dies liegt daran, dass die direkte Weiterleitung nicht mit einem Skype for Business-Client mit medienumgehung verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="8511b-349">If the call was initially established with media bypass, and the call is transferred to a Skype for Business client, Direct Routing needs to insert a Media Processor--this is because Direct Routing cannot be used with a Skype for Business client with media bypass.</span></span> <span data-ttu-id="8511b-350">Das direkte Routing startet den ICE-Neustart Prozess, indem die Ice-pwd-und Ice-ufrag geändert und neue Medien Kandidaten in einer erneuten Einladung angeboten werden.</span><span class="sxs-lookup"><span data-stu-id="8511b-350">Direct Routing starts the ICE restart process by  changing the ice-pwd and ice-ufrag and offering new media candidates in a reinvite.</span></span> 


